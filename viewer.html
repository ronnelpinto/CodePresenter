<!DOCTYPE html>
<html>
   <head>
      <meta name="viewport" content="width=device-width, initial-scale=1">
      <title>Perfect Presenter</title>
      <script type="text/javascript" src="./lib/c_parser.js"></script>
      <script type="text/javascript" src="./lib/java_parser.js"></script>
      <script type="text/javascript" src="./lib/python_parser.js"></script>
      <script type="text/javascript" src="./lib/jquery-2.1.3.js"></script>
      <script type="text/javascript" src="./lib/jquery.snippet.js"></script>
	  	  <link rel="stylesheet" href="./css/codemirror.css">
	  <script src="./lib/codemirror.js"></script>
	   <script type="text/javascript" src="./lib/clike/clike.js"></script>
      <script type="text/javascript" src="./lib/python/python.js"></script>
      <link type="text/css" rel="stylesheet" href="./css/jquery.snippet.css">
      <link type="text/css" rel="stylesheet" href="./css/bootstrap.css">
      <link type="text/css" rel="stylesheet" href="./css/bootstrap-theme.css">
      <script type="text/javascript" src="./lib/config.js"></script>
      <script type="text/javascript" src="./lib/bootstrap.js"></script>
      <script type="text/javascript" src="./lib/reader.js"></script>
	  <link rel="stylesheet" href="./css/theme/3024-day.css">
	<link rel="stylesheet" href="./css/theme/3024-night.css">
	<link rel="stylesheet" href="./css/theme/ambiance.css">
	<link rel="stylesheet" href="./css/theme/base16-dark.css">
	<link rel="stylesheet" href="./css/theme/base16-light.css">
	<link rel="stylesheet" href="./css/theme/blackboard.css">
	<link rel="stylesheet" href="./css/theme/cobalt.css">
	<link rel="stylesheet" href="./css/theme/colorforth.css">
	<link rel="stylesheet" href="./css/theme/eclipse.css">
	<link rel="stylesheet" href="./css/theme/elegant.css">
	<link rel="stylesheet" href="./css/theme/erlang-dark.css">
	<link rel="stylesheet" href="./css/theme/lesser-dark.css">
	<link rel="stylesheet" href="./css/theme/liquibyte.css">
	<link rel="stylesheet" href="./css/theme/mbo.css">
	<link rel="stylesheet" href="./css/theme/mdn-like.css">
	<link rel="stylesheet" href="./css/theme/midnight.css">
	<link rel="stylesheet" href="./css/theme/monokai.css">
	<link rel="stylesheet" href="./css/theme/neat.css">
	<link rel="stylesheet" href="./css/theme/neo.css">
	<link rel="stylesheet" href="./css/theme/night.css">
	<link rel="stylesheet" href="./css/theme/paraiso-dark.css">
	<link rel="stylesheet" href="./css/theme/paraiso-light.css">
	<link rel="stylesheet" href="./css/theme/pastel-on-dark.css">
	<link rel="stylesheet" href="./css/theme/rubyblue.css">
	<link rel="stylesheet" href="./css/theme/solarized.css">
	<link rel="stylesheet" href="./css/theme/the-matrix.css">
	<link rel="stylesheet" href="./css/theme/tomorrow-night-bright.css">
	<link rel="stylesheet" href="./css/theme/tomorrow-night-eighties.css">
	<link rel="stylesheet" href="./css/theme/twilight.css">
	<link rel="stylesheet" href="./css/theme/vibrant-ink.css">
	<link rel="stylesheet" href="./css/theme/xq-dark.css">
	<link rel="stylesheet" href="./css/theme/xq-light.css">
	<link rel="stylesheet" href="./css/theme/zenburn.css">
      <style type="text/css">
		pre {
		 white-space: pre-wrap;       /* css-3 */
		 white-space: -moz-pre-wrap;  /* Mozilla, since 1999 */
		 white-space: -pre-wrap;      /* Opera 4-6 */
		 white-space: -o-pre-wrap;    /* Opera 7 */
		 word-wrap: break-word;       /* Internet Explorer 5.5+ */
		}
		 html {
         font-size: 62.5%;
         }
         body {
         font-size: 1em;
         }
         @media (max-width: 300px) {
         html {
         font-size: 75%;
         }
         pre {
         word-break: keep-all;
         font-family:Courier ;
         font-size: 90%;
         }
         }
         @media (min-width: 500px) {
         html {
         font-size: 80%;
         }
         pre {
         word-break: keep-all;
         font-family:Courier ;
         font-size: 90%;
         }
         }
         @media (min-width: 700px) {
         html {
         font-size: 100%;
         }
         pre {
         word-break: keep-all;
         font-family:Courier ;
         font-size: 95%;
         }
         }
         @media (min-width: 1200px) {
         html {
         font-size: 150%;
         }
         pre {
         word-break: keep-all;
         font-size: 100%;
         }
         }button {
         height: 35px;
         border: none;
         border-radius: 4px;
         font-size: 14px;
         color: #fff;
         font-weight: bold;
         text-shadow: 1px 1px 0 rgba(0,0,0,0.3);
         overflow: hidden;
         outline: none;
         }
         button.submitbtn {
         background-image: -moz-linear-gradient(#97c16b, #8ab959);
         background-image: -webkit-linear-gradient(#97c16b, #8ab959);
         background-image: linear-gradient(#97c16b, #8ab959);
         border-bottom: 1px solid #648c3a;
         cursor: pointer;
         color: #fff;h
         }
         button.submitbtn:hover {
         background-image: -moz-linear-gradient(#8ab959, #7eaf4a);
         background-image: -webkit-linear-gradient(#8ab959, #7eaf4a);
         background-image: linear-gradient(#8ab959, #7eaf4a);
         }
         button.submitbtn:active {
         height: 34px;
         border-bottom: 0;
         margin: 1px 0 0 0;
         background-image: -moz-linear-gradient(#7eaf4a, #8ab959);
         background-image: -webkit-linear-gradient(#7eaf4a, #8ab959);
         background-image: linear-gradient(#7eaf4a, #8ab959);
         -moz-box-shadow: inset 0 1px 3px 1px rgba(0, 0, 0, 0.3);
         -webkit-box-shadow: inset 0 1px 3px 1px rgba(0, 0, 0, 0.3);
         box-shadow: inset 0 1px 3px 1px rgba(0, 0, 0, 0.3);
         }
      </style>
   </head>
   <body onload="init();">
      <div class="container-fluid">
         <div class="row">
            <div class="col-xs-4 col-xs-offset-1">
               <div class="row">

               </div>
            </div>
            </br>
            <div class="col-xs-12" style="text-align:center">
               <a id="prev-style" href="#">Prev</a>
                <select id=theme_select>
					<option selected>default</option>
					<option>3024-day</option>
					<option>3024-night</option>
					<option>ambiance</option>
					<option>base16-dark</option>
					<option>base16-light</option>
					<option>blackboard</option>
					<option>cobalt</option>
					<option>colorforth</option>
					<option>eclipse</option>
					<option>elegant</option>
					<option>erlang-dark</option>
					<option>lesser-dark</option>
					<option>liquibyte</option>
					<option>mbo</option>
					<option>mdn-like</option>
					<option>midnight</option>
					<option>monokai</option>
					<option>neat</option>
					<option>neo</option>
					<option>night</option>
					<option>paraiso-dark</option>
					<option>paraiso-light</option>
					<option>pastel-on-dark</option>
					<option>rubyblue</option>
					<option>solarized dark</option>
					<option>solarized light</option>
					<option>the-matrix</option>
					<option>tomorrow-night-bright</option>
					<option>tomorrow-night-eighties</option>
					<option>twilight</option>
					<option>vibrant-ink</option>
					<option>xq-dark</option>
					<option>xq-light</option>
					<option>zenburn</option>
				</select>
               <a id="next-style" href="#">Next</a>
            </div>
            </br>
            </br>
            <div class="col-submit">
            </div>
         </div>
         <div id='outer'>
         </div>
      </div>
      <script type="text/javascript">
         
		function init() {
			$('#theme_select').change(apply_theme);
			$("#prev-style").click(function() {
				$(this).blur();
				var sel = $("#theme_select option:selected");
				var index = sel.index();
				var selme = index - 1;
				if (selme == -1) {
					selme = ($('#theme_select option').length) - 1
				};
				sel.removeAttr("selected");
				$("#theme_select option").eq(selme).attr("selected", "selected");
				apply_theme();
				return false;
			});

			$("#next-style").click(function() {
				$(this).blur();
				var sel = $("#theme_select option:selected");
				var index = sel.index();
				var selme = index + 1;
				if (selme == ($('#theme_select option').length)) {
					selme = 0
				};
				sel.removeAttr("selected");
				$("#theme_select option").eq(selme).attr("selected", "selected");
				apply_theme();
				return false;
			});
			apply_theme();
			blocks();
		}

        function apply_theme_with_obj(id, obj, lang) {
			obj = JSON.parse(obj);
            var theme = $('#theme_select').find(":selected").text();
			var all = document.getElementsByClassName(id);
			for ( i = 0; i < all.length; i++){
				var text = all[i].parentNode.childNodes[1];
				all[i].parentNode.removeChild(text); 
				var editor = CodeMirror.fromTextArea(all[i], {});
				editor.setOption("theme", theme);
				editor.setOption("mode", lang);
				editor.setOption("readOnly", true);
				editor.setOption("lineWrapping", obj['lineWrapping']);
				editor.setOption("lineNumbers", obj['lineNumbers']);
				editor.setOption("showCursorWhenSelecting", obj['showCursorWhenSelecting']);
				editor.setOption("lineWiseCopyCut", obj['lineWiseCopyCut']);
				editor.setOption("maxHighlightLength", obj['maxHighlightLength']);
				editor.setSize('100%','100%');
			}
        }
		var reader = new Reader();

		var file;
		var x = ''

		function blocks() {
			var blocks = JSON.parse(localStorage.getItem("file_contents"))
			if (blocks != 'nothing') {
				var blockslen = blocks.length;
				for (var i = 0; i < blockslen; i++) {
					
					if(blocks[i].indexOf("<pp_") == -1) {
						generatePara(blocks[i],i);
						continue;
					}
					if(blocks[i].indexOf("<pp_img>") != -1) {
						generateImage(blocks[i],i);
						continue;
					}
					if(blocks[i].indexOf("<pp_c>") != -1) {
						generateC(blocks[i],i);
						continue;
					}
					if(blocks[i].indexOf("<pp_cl>") != -1) {
						generateCl(blocks[i],i);
						continue;
					}
					if(blocks[i].indexOf("<pp_java>") != -1) {
						generateJava(blocks[i],i);
						continue;
					}
					if(blocks[i].indexOf("<pp_javal>") != -1) {
						generateJaval(blocks[i],i);
						continue;
					}
					if(blocks[i].indexOf("<pp_py>") != -1) {
						generatePython(blocks[i],i);
						continue;
					}
				}
			}
		}
		
		function apply_theme() {
			var c = get_c_config();
			var java = get_java_config();
			var python = get_python_config();
			apply_theme_with_obj('indented_c',c,"clike");
			apply_theme_with_obj('indented_java',java,"clike");
			apply_theme_with_obj('indented_python',python,"python");
		}
		
		function generatePara(text, i) {
			$('#outer').append("<div id='text_div" + i + "'></div>");
			$('#text_div' + i).html("<p>"+text+"</p>");
		}
		
		function generateCl(text, i) {
			var temp = text.split("<pp_cl>")[1]
			var link = temp.split("</pp_cl>")[0]
			$('#outer').append("<div id='code_div" + i + "'></div>");
			$('#code_div' + i).html("<textarea readonly style='overflow:hidden;resize:none;width:100%;'  class='indented_c' id='" + i + "'></textarea>")
			var xhr = new XMLHttpRequest();
			xhr.open("GET", "get_code.php?filename="+link, false);
			xhr.send();
			var obj = get_c_config();
			$('#' + i).html(c_beautify(xhr.responseText,JSON.parse(obj)))
			resize(i,'clike',obj);			 
		}
		
		function generateJaval(text, i) {
			var temp = text.split("<pp_javal>")[1]
			var link = temp.split("</pp_javal>")[0]
			$('#outer').append("<div id='code_div" + i + "'></div>");
			$('#code_div' + i).html("<textarea readonly style='overflow:hidden;resize:none;width:100%;' class='indented_java' id='" + i + "'></textarea>")
			var xhr = new XMLHttpRequest();
			xhr.open("GET", "get_code.php?filename="+link, false);
			xhr.send();
			var obj = get_java_config();
			$('#' + i).html(java_beautify(xhr.responseText,JSON.parse(obj)))
			resize(i,'clike',obj);
		}
		
		function generateC(text, i) {
			var temp = text.split("<pp_c>")[1]
			var link = temp.split("</pp_c>")[0]
			$('#outer').append("<div id='code_div" + i + "'></div>");
			$('#code_div' + i).html("<textarea readonly style='overflow:hidden;resize:none;width:100%;' class='indented_c' id='" + i + "'></textarea>")
			var obj = get_c_config();
			$('#' + i).html(c_beautify(link,JSON.parse(obj)))
			resize(i,'clike',obj);
		}
		function resize(id,lang,obj) {
			 obj = JSON.parse(obj);
			 var text = document.getElementById(id);
			 text.style.height = 'auto';
			 text.style.height = text.scrollHeight+'px';
			var editor = CodeMirror.fromTextArea(text, {theme: 'default',
														mode: lang});
			editor.setOption("readOnly", true);
			editor.setOption("lineWrapping", obj['lineWrapping']);
			editor.setOption("lineNumbers", obj['lineNumbers']);
			editor.setOption("showCursorWhenSelecting", obj['showCursorWhenSelecting']);
			editor.setOption("lineWiseCopyCut", obj['lineWiseCopyCut']);
			editor.setOption("maxHighlightLength", obj['maxHighlightLength']);
			editor.setSize('100%','100%');
		}
		function generateJava(text, i) {
			var temp = text.split("<pp_java>")[1]
			var link = temp.split("</pp_java>")[0]
			$('#outer').append("<div id='code_div" + i + "'></div>");
			$('#code_div' + i).html("<textarea readonly style='overflow:hidden;resize:none;width:100%;' class='indented_java' id='" + i + "'></textarea>")
			var obj = get_java_config();
			$('#' + i).html(java_beautify(link,JSON.parse(obj)))
			resize(i,'clike',obj);
		}
		
		function generatePython(text, i) {
			var temp = text.split("<pp_py>")[1]
			var link = temp.split("</pp_py>")[0]
			$('#outer').append("<div id='code_div" + i + "'></div>");
			$('#code_div' + i).html("<textarea readonly style='overflow:hidden;resize:none;width:100%;' class='indented_python' id='" + i + "'></textarea>")
			var xhr = new XMLHttpRequest();
			var formData = new FormData();
			formData.append("input", link);
			var obj = get_python_config();
			obj1 = JSON.parse(obj);
			formData.append("indent-size", obj1['indent_size'])
			formData.append("max_line_length", obj1['max-line-length'])
			xhr.open("POST", "python_reindent.php", false);
			xhr.send(formData);
			$('#' + i).html(xhr.responseText);
			resize(i,'python',obj);
		}
		
		function generateImage(text, i) {
			var temp = text.split("<pp_img>")[1]
			var arr = temp.split("</pp_img>")
			var link = arr[0]
			var title_tag = arr[1]
			var title =false
			if(title_tag.indexOf('title')!=-1){
				title=true
			var title = title_tag.split("=")[1]
			title=title.split(">")[0]
			var title_ele = "<p style='color:red;'>"+title+"<p>"
			}
			if(link.indexOf("<center>") !=-1){
				link1 = link.split("<center>")[1]
				$('#outer').append("<div id='img_div" + i + "' style='text-align:center'></div>");
				$('#img_div' + i).html("<img src='getImage.php?file=" + link1 + "' style='max-width:100%;' width=400px ;height=400px;>")
				if(title){
					$('#img_div' + i).append($(title_ele));
				}
				}
			else{
				$('#outer').append("<div id='img_div" + i + "' ></div>");
				$('#img_div' + i).html("<img src='getImage.php?file=" + link + "' style='max-width:100%;' width=400px height=400px>")
				if(title){
					$('#img_div' + i).append($(title_ele));
				}
				}
			
		}       
      </script>	
   </body>
</html>